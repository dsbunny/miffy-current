{"version":3,"file":"prefetch.bundle.mjs","sources":["../node_modules/.pnpm/comlink@4.4.2/node_modules/comlink/src/comlink.ts","../src/workers/prefetch.service-worker.ts"],"sourcesContent":[null,"// vim: tabstop=8 softtabstop=0 noexpandtab shiftwidth=8 nosmarttab\n// Copyright 2025 Digital Signage Bunny Corp. Use of this source code is\n// governed by an MIT-style license that can be found in the LICENSE file or at\n// https://opensource.org/licenses/MIT.\n\nexport type {};\ndeclare var self: ServiceWorkerGlobalScope;\n\nimport * as Comlink from 'comlink';\nimport { AssetDecl } from '../lib/media.js';\nimport { PrefetchWorker } from '../workers/prefetch.worker.js';\n\nclass PrefetchServiceWorker {\n\tconstructor() {\n\t\tself.addEventListener('install', (event: ExtendableEvent) => {\n\t\t\tself.skipWaiting();\n\t\t\tevent.waitUntil(this.#install());\n\t\t});\n\t\tself.addEventListener('fetch', (event: FetchEvent) => {\n\t\t\t// Let the browser do its default thing\n\t\t\t// for non-GET requests.\n\t\t\tif (event.request.method !== \"GET\") {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tevent.respondWith(this.#fetch(event.request));\n\t\t});\n\t\tself.addEventListener('activate', (event: ExtendableEvent) => {\n\t\t\tevent.waitUntil(this.#activate());\n\t\t});\n//\t\tself.addEventListener('message', (event: ExtendableMessageEvent) => {\n//\t\t\tthis.#onMessage(event.source, event.data);\n//\t\t});\n\t}\n\n\tasync #install() {\n\t\tconst cache = await self.caches.open('miffy');\n\t\tconst hrefs = [\n\t\t\t'/media/favicon.png',\n\t\t\t'/index.html',\n\t\t\t'../dist/calendar.bundle.mjs',\n\t\t\t'../dist/prefetch.bundle.mjs',\n\t\t\t'../dist/scheduler.bundle.mjs',\n\t\t\t'../dist/web.bundle.mjs',\n\t\t\t'../dist/webgl.bundle.mjs',\n\t\t\t'/external/node_modules/three/build/three.module.js',\n\t\t];\n\t\tconst options = {\n\t\t\tmethod: 'GET',\n\t\t\tcache: 'force-cache' as RequestCache,\n\t\t};\n\t\tconst resources = hrefs.map(href => {\n\t\t\tconst request = new Request(href, options);\n\t\t\treturn request;\n\t\t});\n\t\tconsole.info(`PREFETCH-SERVICEWORKER: Start.`);\n\t\tconst t0 = performance.now();\n\t\ttry {\n\t\t\tawait this.#cacheAddAll(cache, resources);\n\t\t} catch(e) {\n\t\t\tconsole.warn(`PREFETCH-SERVICEWORKER: Failed preparing resources: ${e}.`);\n\t\t} finally {\n\t\t\tconst t1 = performance.now();\n\t\t\tconsole.info(`PREFETCH-SERVICEWORKER: Complete ${Math.round(t1 - t0)}ms.`);\n\t\t}\n\t}\n\n\t// Explicitly add one request at a time to ensure all resources\n\t// are settled, compare to Cache.AddAll which bails on first error.\n\tasync #cacheAddAll(cache: Cache, resources: Request[]) {\n\t\tconst deferred = [];\n\t\tconst networkFetch = async (request: Request) => {\n\t\t\tconst networkResponse = await fetch(request);\n\t\t\tif(networkResponse.ok\n\t\t\t\t&& networkResponse.status !== 206)\n\t\t\t{\n\t\t\t\tawait cache.put(request, networkResponse);\n\t\t\t\tconsole.log(`PREFETCH-SERVICEWORKER: Cache updated ${request.url}`, request);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconsole.warn(`PREFETCH-SERVICEWORKER: Failed ${request.url}`, request);\n\t\t};\n\t\tconst t0 = performance.now();\n\t\tfor(const request of resources) {\n\t\t\ttry {\n\t\t\t\tconst cachedResponse = await cache.match(request);\n\t\t\t\tif(!cachedResponse) {\n\t\t\t\t\tawait networkFetch(request);\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.push(networkFetch(request));\n\t\t\t\t}\n\t\t\t} catch(ex) {\n\t\t\t\tconsole.warn(`PREFETCH-SERVICEWORKER: ${ex}`);\n\t\t\t}\n\t\t}\n\t\tconst t1 = performance.now();\n\t\tconsole.log(`PREFETCH-SERVICEWORKER: Fetch ${Math.round(t1 - t0)}ms.`);\n\t\tif(deferred.length) {\n\t\t\ttry {\n\t\t\t\tawait Promise.allSettled(deferred);\n\t\t\t} catch(ex) {\n\t\t\t\tconsole.warn(`PREFETCH-SERVICEWORKER: ${ex}`);\n\t\t\t}\n\t\t\tconst t2 = performance.now();\n\t\t\tconsole.log(`PREFETCH-SERVICEWORKER: Revalidate ${Math.round(t2 - t1)}ms.`);\n\t\t}\n\t}\n\n\tasync #fetch(request: Request) {\n\t\t// Response should include `Vary: Origin` and `Vary: Accept-Encoding`.\n\t\tconst cachedResponse = await self.caches.match(request, { ignoreVary: true });\n\t\tif(cachedResponse) {\n\t\t\t//console.log(`PREFETCH-SERVICEWORKER: Cache hit ${request.url}.`);\n\t\t\treturn cachedResponse;\n\t\t}\n\t\t// Default to network if unavailable in cache, i.e. SSE streams.\n\t\tconsole.log(`PREFETCH-SERVICEWORKER: Cache miss ${request.url}.`, request);\n\t\treturn fetch(request);\n\t}\n\n\tasync #activate() {\n\t\tawait this.#upgradeCaches();\n\t\t// Take control of pages immediately, including those loaded\n\t\t// via a different service worker.\n\t\tawait self.clients.claim();\n\t}\n\n\t// REF: https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/activate_event\n\t// Typically delete old caches.\n\tasync #upgradeCaches() {\n\t\t// no-op.\n\t}\n\n\tasync setSources(scope: string, sources: AssetDecl[]) {\n\t\tconsole.log(`PREFETCH-SERVICEWORKER: Cache scope ${scope}.`);\n\t\tconst cache = await self.caches.open(scope);\n\t\tconst options: RequestInit = {\n\t\t\tcache: 'no-cache',\n\t\t\tcredentials: 'omit',\n\t\t\tkeepalive: true,\n\t\t\tmethod: 'GET',\n\t\t\tmode: 'cors',\n\t\t\t//priority: 'low',\n\t\t\tredirect: 'follow',\n\t\t\treferrer: 'client',\n\t\t\treferrerPolicy: 'strict-origin-when-cross-origin',\n\t\t};\n\t\tawait this.#cacheAddAll(cache, sources.map(source => {\n\t\t\tconst request = new Request(source.href, {\n\t\t\t\t// FIXME: SRI crying wolf.\n\t\t\t\t//integrity: source.integrity,\n\t\t\t\t...options,\n\t\t\t});\n\t\t\treturn request;\n\t\t}));\n\t\tconsole.log(`PREFETCH-SERVICEWORKER: Complete scope ${scope}.`);\n\t}\n}\n\nconsole.info(\"PREFETCH-SERVICEWORKER: Started.\");\nconst prefetch_service_worker = new PrefetchServiceWorker();\n\nself.addEventListener('message', (event: ExtendableMessageEvent) => {\n\tif(event.data instanceof MessagePort) {\n\t\tComlink.expose({\n\t\t\tsetSources: async (scope: string, sources: AssetDecl[]) => {\n\t\t\t\tawait prefetch_service_worker.setSources(scope, sources);\n\t\t\t},\n\t\t} as PrefetchWorker, event.data);\n\t\tevent.data.start();\n\t}\n});\n"],"names":["Comlink.expose"],"mappings":"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","x_google_ignoreList":[0]}